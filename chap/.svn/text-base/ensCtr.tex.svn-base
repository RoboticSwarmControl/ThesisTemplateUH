% Thesis 

\chapter[Ensemble Control]{Ensemble Control}
\label{chap-ensCtr}

\begin{figure}[!ht]
\centering
 \begin{overpic}[height=0.4\columnwidth]{classicalNonholonomicUnicycle3D}
\small
	\put(3,22){$x$}
	\put(8,37){$y$}
	\put(62,23){$u_1$}
	\put(51,80){$u_2$}
	\put(75,7){$\theta$}
	\put(17,-15){\parbox{11em}{\centering\emph{Nonholonomic Unicycle} J.P. Laumond, 1987}}%J.P. Laumond, Feasible trajectories for mobile robots with kinematic and environment constraints, Intelligent Autonomous Systems, L.O. Hertzberger, F.C.A. Groen Edts, North-Holland, pp. 346-354, 1987.
\end{overpic}
\hspace{.2em}
\begin{overpic}[height=0.4\columnwidth]{classicalPlateBall}
\small
	\put(56,48){$R$}
	\put(58,68){$u_1$}
	\put(65,76){$u_2$}
	\put(60,12){$x$}
	\put(66,21){$y$}
	\put(20,-15){\parbox{10.5em}{\centering\emph{Plate-Ball Manipulator} Brockett and Dai, 1993}}
\end{overpic}
\vspace{3em}
\caption{\label{fig:TwoClassicalRoboticSystems}
Two classical robotic systems.  On the left, a nonholonomic unicycle, a canonical model for robot motion planning.  On the right, a plate-ball manipulator, a canonical model for robotic manipulation.  %These systems have been studied extensively for over two decades.  
This dissertation answers the question, ``Are these systems still controllable under model perturbation that scales all the inputs by an unknown but  bounded constant?''}\end{figure}

Figure \ref{fig:TwoClassicalRoboticSystems} depicts two classical robotic systems: the nonholonomic unicycle and the plate-ball manipulator. 
 The nonholonomic unicycle is a canonical model for mobile robotics (Laumound, 1987 \cite{Laumond1987}), and is used to describe robots including %roombas\textsuperscript{\textregistered},
 differential-drive vehicles,  tanks and cars.  It has two inputs,  forward speed $u_1$ and turning rate $u_2$.
 The plate-ball manipulator is a canonical model for robotic manipulation by rolling (Brockett, 1993 \cite{Brockett1993}).  In the classical version of this system, the ball is held between two parallel plates and manipulated by maneuvering the upper plate while holding the lower plate fixed. The ball can be brought to any position and orientation though translations of the upper plate. Inputs are speed of the ball center along the $x$-axis $u_1$ and speed along the $y$-axis $u_2$.\\
 
 For decades it has been known that both these systems are controllable.  There are many ways to solve the open-loop steering problem, sometimes called the motion planning problem, for these two systems.  This dissertation addresses the question, ``Are these two systems still controllable under model perturbation that scales all the inputs by an unknown but  bounded constant?''   This type of model perturbation arises if we do not know the radius of the wheel and if we do not know the radius of the ball.
 
 Rather than steer a single system with an unknown parameter, we chose to model the system as a set of control systems that depend continuously on the unknown parameter.  This set we call an \emph{ensemble}.  This dissertation proves that these ensembles are still controllable, after defining precisely what it means to be ``controllable'' in this context.  We then give a steering algorithm based on piecewise-constant inputs and Taylor series approximations.  Next, we show that by introducing feedback we can use a similar approach to control multiple nonholonomic unicycles when each unicycle receives exactly the same input command. We use the three hardware platforms shown in Fig.~\ref{fig:threeMotivationalProblems} to validate our approach.


   \begin{figure}
\centering
\href{http://www.youtube.com/watch?v=8yYD_KMwfaM}{\subfloat{\label{fig:UniUnknownWheelSize}\frame{\includegraphics[height=0.32\columnwidth]{SegbotDreamS}}}}\hspace{.1em}
\href{http://www.youtube.com/watch?v=nPGz0Nd3QzE}{\subfloat{\label{fig:BallsUnknownRadii}\frame{\includegraphics[height=0.32\columnwidth]{Magnetic4WordsBright}}}}\hspace{.1em}
\href{http://www.youtube.com/watch?v=50gb5WMqJbY}{\subfloat{\label{fig:ManyDiffDrive}\frame{\includegraphics[height=0.32\columnwidth]{Clump6RobotsSM}}}}
\caption{\label{fig:threeMotivationalProblems} 
In this dissertation we apply the framework of ensemble control theory to control the three robotic systems shown above.} % Three motivational problems for this dissertation.
\end{figure}

Fig. \ref{fig:IntroUniPaths} uses a nonholonomic unicycle to illustrate the main contribution of this thesis.  In this figure, a unicycle with an unknown wheel radius is commanded to translate sideways (a parallel-parking maneuver).  A controller designed for the nominal wheel radius results in a wide spread of the set of possible ending positions.  Our controller brings all possible ending positions arbitrarily close to the desired goal position.  

   \begin{figure}
\centering\href{http://www.youtube.com/watch?v=_v4KUBfzbv0}{
\includegraphics[width=0.8\columnwidth]{IntroDisturbedUniPath}
\includegraphics[width=0.8\columnwidth]{IntroEnsemblePath} }
\caption{\label{fig:IntroUniPaths} 
Piecewise constant input trajectories applied to a unicycle with unknown wheel radius.  Top: a nominal controller results in a wide range of possible ending positions of the unicycle as a function of wheel size.  Bottom: our controller brings all possible ending positions arbitrarily close to the desired goal position.  Goal and start positions are drawn in green.  The input trajectory for each controller is shown above the plots.  Representative unicycles are drawn using black discs and a blue orientation marker. Red lines show state trajectories. \\
\href{http://www.youtube.com/watch?v=_v4KUBfzbv0}{(Video online: http://www.youtube.com/watch?v=\_v4KUBfzbv0)} 
}
\end{figure}


\section{Framework of Ensemble Control Theory}\label{Framework of Ensemble Control Theory}
  In this section we state formally what it means
to be ensemble controllable.  These definitions closely follow~\cite{Brockett1999,Khaneja2000,Li2006,Li2006b,Li2006a,Li2007,Li2009,Li2011,Ruths2011,Ruths2011a,Beauchard2010,Beauchard2010a} and will be used throughout the dissertation for the systems shown in Fig.~\ref{fig:threeMotivationalProblems}.
 
\begin{definition}
Consider the family of control systems
\[
\dot{q}(t,\epsilon) = f\left(q(t,\epsilon),u(t),t,\epsilon\right),
\]
where $q\in \Cspace \subset\R^{n}$, $u\in\Uspace\subset\R^{m}$, $\epsilon\in[1-\delta,1+\delta]$ for $0\leq\delta<1$, and $f$ is a smooth function. This family is \emph{ensemble controllable} on
the function space
$L_{2}\left([1-\delta,1+\delta],\Cspace\right)$ if for all $\mu>0$ and continuous $\qstart,\qgoal\in L_{2}\left([1-\delta,1+\delta],\Cspace\right)$ there exists $T>0$ and piecewise-continuous $u\colon[0,T]\to\Uspace$ such that $q(0,\epsilon) = \qstart(\epsilon)$ and $\norm{q(T,\epsilon)-\qgoal(\epsilon)}\leq\mu$ for all $\epsilon\in[1-\delta,1+\delta]$.
\end{definition}

Note that  we allow $\qstart$ and $\qgoal$ to be arbitrary functions of $\epsilon$. As pointed out by \cite{Beauchard2010}, the reader should interpret being ensemble controllable as being approximately controllable on $L_{2}\left([1-\delta,1+\delta],\Cspace\right)$.  

To illustrate these concepts the following section focuses on a specific example, the nonholonomic unicycle.  This system, shown on the left in Fig. \ref{fig:TwoClassicalRoboticSystems}, will be studied in Chapter \ref{chap-infUnicycle} and revisited in Chapter \ref{chap:FeedbackControlDiffDrive}.


\subsection{A Case Study: An Ensemble of Unicycles}

Consider Fig \ref{fig:UnicycleWheelRadEnsContIntro}, a single unicycle that rolls without slipping. We describe its configuration by $q=(x,y,\theta)$ and its configuration space by $\Cspace = \R^2 \times \field{S}^1$. The control inputs are the forward speed
%~${u_1\in\R}$
$u_{1}$
and the turning rate
$u_{2}$.
\begin{figure}
      \centering
      \begin{overpic}[width=.6\columnwidth]{UnicycleWheelRadEnsCont}

				\put(52,4){$x$ }
				\put(-5,50){$y$ }
				\put(70,62){$\theta, \epsilon u_2(t)$ }
				\put(50,80){$\epsilon u_1(t)$ }
				\put(32,22){$b$ }
				\put(71,20){$r\epsilon$ }
	\end{overpic}
      \caption{\label{fig:UnicycleWheelRadEnsContIntro} A differential-drive robot is a nonholonomic unicycle.  This system has parameter perturbation that scales the wheel radius by an unknown, bounded constant $\epsilon$.   The state is $(x,y,\theta)$ with inputs $u_1(t)$ and $u_2(t)$. % We model the robot as an ensemble control system, show the system is ensemble controllable, and derive an approximate steering algorithm to bring the system to within an arbitrarily small neighborhood of any given goal configuration.
      }
   \end{figure}
%$u_2\in\R$.
%We define a constraint set $\Uspace\subset\R^{2}$ that is symmetric with respect to the origin and that has affine hull $\R^{2}$.
%We restrict $(u_{1},u_{2})\in\Uspace$ for some constraint set $\Uspace\subset\R^{2}$,
%with the standard assumption
%where we assume that $\Uspace$ is symmetric with respect to the origin and that the affine hull of $\Uspace$ is $\R^{2}$.
%where we assume that $\Uspace$ is symmetric about the origin and that the affine hull of $\Uspace$ is $\R^{2}$.
Corresponding to these inputs, we define vector fields~$g_1,g_2\colon\Cspace\to{T_q\Cspace}$ by
\[
g_1(q) = \begin{bmatrix} \cos\theta\\ \sin\theta\\ 0 \end{bmatrix}
\qquad\qquad
g_2(q) = \begin{bmatrix}  0\\ 0\\ 1 \end{bmatrix}
\]
and write the kinematics of the unicycle in the standard form
\begin{equation}
\label{eq:oneIntro}
\dot{q}(t) = g_1(q(t)) u_1(t) + g_2(q(t)) u_2(t).
\end{equation}
Given $\qstart,\qgoal\in\Cspace$ and $\mu>0$, the approximate steering
problem
%for a single unicycle
is to find open-loop inputs
\[
\left(u_{1}(t),u_{2}(t)\right) \colon [0,T] \to \Uspace
\]
that result in $q(0)=\qstart$ and $\norm{q(T)-\qgoal}\leq\mu$ for free final time $T$, where $\norm{\cdot}$ is a suitable norm on $\Cspace$.
If such inputs always exist then we say that \eqref{eq:oneIntro} is {\em approximately controllable}---and indeed they do, since $g_{1}$, $g_{2}$, and the Lie bracket $[g_{1},g_{2}]$ span the tangent space $T_{q}\Cspace$ everywhere.


In Chapter \ref{chap-infUnicycle} we will solve this same approximate steering problem, but under model perturbation that scales both the forward speed $u_{1}$ and the turning rate $u_{2}$ by some unknown, bounded constant. The resulting kinematics have the form
\begin{equation}
\label{eq:oneIntrouncertain}
\dot{q}(t) = \epsilon\left( g_1(q(t)) u_1(t) + g_2(q(t)) u_2(t) \right),
\end{equation}
where $\epsilon \in [1-\delta, 1+\delta]$ for some $0 \leq \delta < 1$. Rather than try to steer one unicycle governed by \eqref{eq:oneIntrouncertain}---where $\epsilon$ is unknown---our approach is to steer an uncountably infinite collection of unicycles parameterized by~$\epsilon$, each one governed by
\begin{equation}
\label{eq:ensembleINTRO}
\dot{q}(t,\epsilon) = \epsilon \bigl( g_1\left( q(t,\epsilon) \right) u_1(t) + g_2\left( q(t,\epsilon) \right) u_2(t) \bigr).
\end{equation}
Following the terminology introduced
%by recent work in control theory
in Section \ref{Framework of Ensemble Control Theory}, we call this fictitious collection of unicycles an {\em ensemble} and call~\eqref{eq:ensembleINTRO} an {\em ensemble control system}.
%The state of this system is no longer a point in the configuration space $\Cspace$ but rather a point in the function space $L_{\infty}\left([1-\delta,1+\delta],\Cspace\right)$.
The idea is that if we can find
%a single set of
open-loop inputs $u_{1}(t)$ and $u_{2}(t)$ that result in $q(0,\epsilon)=\qstart$ and
%$\norm{q(T,\epsilon)-\qgoal}_{\infty}\leq\mu$
$\norm{q(T,\epsilon)-\qgoal}\leq\mu$
for all $\epsilon \in [1-\delta,1+\delta]$, then we can certainly guarantee that the actual unicycle, which corresponds to one particular value $\epsilon^{\ast}$ of $\epsilon$, will satisfy $\norm{q(T,\epsilon^{\ast})-\qgoal}\leq\mu$.
If such inputs always exist then we say that \eqref{eq:ensembleINTRO} is {\em ensemble controllable},
%which should be
interpreted as being approximately controllable on the function space $L_{2}\left([1-\delta,1+\delta],\Cspace\right)$.
In Chapter \ref{sec:analysis} we will in fact show that \eqref{eq:ensembleINTRO} is not ensemble controllable, but will proceed to derive a reduced subsystem that is.
Our proof will depend on being able to approximate arbitrary elements of the tangent space to $L_{2}\left([1-\delta,1+\delta],\Cspace\right)$, capturing the essence of classical tests like the Lie algebra rank condition.
%We will in fact prove the contrary, but will then proceed to derive a reduced subsystem that is ensemble controllable.
Solving the approximate steering problem with respect to the subsystem will produce inputs that
reach an arbitrarily small neighborhood of any Cartesian position,
but not of any heading. 

We will apply our work to a differential-drive robot with unknown but bounded wheel radius, showing that~\eqref{eq:oneIntrouncertain} is an appropriate model and validating our approach to approximate steering with hardware experiments. 


%%%%%%%However, let us be clear---in its current form, this application of our work is not
%%%%%%%%in any way
%%%%%%%``practical'' and
%%%%%%%%certainly
%%%%%%%does not improve upon existing methods of motion planning and control for mobile robots. In particular, these robots
%%%%%%%typically
%%%%%%%%often


\subsection{A Brief History of Ensemble Control Theory}

Ensemble control, as presented in \cite{Brockett1999,Khaneja2000,Li2006,Li2006b,Li2006a,Li2007,Li2009,Li2011}, extends the theory of nonlinear controllability from finite-dimensional systems, for example of the form \eqref{eq:oneIntro}, to a particular class of infinite-dimensional systems characterized by a dispersion parameter, for example of the form \eqref{eq:ensembleINTRO} where this parameter is $\epsilon$.
%It is easy to see why such an extension might be necessary.
%Such an extension is necessary because 
The fact that standard controllability theorems rely on checking a rank condition is a clue that such an extension might be necessary. Chow's theorem, for instance, implies that \eqref{eq:oneIntro} is small-time locally controllable---hence, approximately controllable---because the Lie algebra generated by $g_{1}$ and $g_{2}$ has rank 3 everywhere, equal to the dimension of $T_{q}\Cspace$ (e.g., see \cite{Murray1994}).
Both $L_{2}\left([1-\delta,1+\delta],\Cspace\right)$ and its tangent space have infinite dimension, so we will never accumulate enough vector fields to satisfy this same rank condition for \eqref{eq:ensembleINTRO}.
However, we note that the rank condition is only used to guarantee that it is possible to approximate motion in any direction we like.
% by rapid switching between inputs.
For \eqref{eq:oneIntro}, we see that $g_{1}$, $g_{2}$, and
\[
[g_{1},g_{2}] = \frac{\partial g_2}{\partial q} g_1 - \frac{\partial g_1}{\partial q} g_2
\]
are linearly independent and span the tangent space $T_{q}\Cspace$ at every configuration $q\in\Cspace$, so any element of $T_{q}\Cspace$ can be approximated by rapid switching between inputs.
% or in other words that it is possible to approximate motion in any direction we like by rapid switching between inputs.
For \eqref{eq:ensembleINTRO}, it is possible to arrive at a similar result.
In particular, we will take the same basic approach as 
in~\cite{Li2009},
using repeated bracketing
%repeatedly taking Lie brackets
to get higher-order powers of~$\epsilon$
and then using polynomial approximation to construct arbitrary vector flows.
Systems like ours
%the one we consider
are ignored by~\cite{Li2009} after
%they show that
noting that
%the drift-free control system
\[
\dot{q}(t,\epsilon) = \epsilon \sum_{i=1}^{m} g_{i}\left(q(t,\epsilon)\right) u_{i}(t)
\]
is not ensemble controllable if $g_{1},\dotsc,g_{m}$ generate a nilpotent Lie algebra.
We will indeed show that \eqref{eq:ensembleINTRO} is not ensemble controllable in Section~\ref{sec:analysis}, but will then proceed to derive a reduced subsystem that is ensemble controllable.


The origins of this approach are within the physics community. In this context, an ``ensemble'' is
a very large collection of identical or nearly identical molecules, atoms, or elementary particles,
and the goal of ``ensemble control'' is to manipulate the average properties of such an ensemble.
Early work in this area was done, for example, by Simon van der Meer, who won the 1984 Nobel prize in physics for
controlling the density at which circulating protons are packed in an accelerator using applied magnetic fields~\cite{Meer1993}.
The more recent work of Brockett, Khaneja, and Li has found primary application so far to quantum systems, for example manipulating nuclear spins in nuclear magnetic resonance (NMR) spectroscopy~\cite{Brockett1999,Khaneja2000,Li2006,Li2006b,Li2006a,Li2007,Li2009,Li2011}.
Robotics researchers are also beginning to adopt the term ``ensemble,'' for example in the context of multi-robot formations~\cite{Michael2008} and artificial muscle actuators~\cite{Odhner2010}, but the formal methodology of ensemble control has yet to be applied.
%We should also note that other
Other
approaches to dealing with infinite-dimensional systems---such as taking advantage of differential flatness---have been developed in parallel, as in~\cite{Rouchon2001}.
The main tool used in this other work is functional analysis, which
has recently started to inform ongoing work in ensemble control~\cite{Beauchard2010}.



\section[Alternative Frameworks to Ensemble Control Theory]{Alternative Frameworks to\\Ensemble Control Theory}

We note that %mobile 
robots often
have both proprioceptive (e.g., odometry) and exteroceptive (e.g., sonar, laser, vision) sensors.
With state estimates that come from these sensors,
%Using these sensors,
it is easy to build a feedback controller that guarantees exact asymptotic convergence to any given Cartesian  position under the same type of model perturbation that we consider \cite[Chap. 11.6.2]{Siciliano2009}.
It is just as easy to build a robust feedback controller that regulates posture and not just Cartesian position \cite{Lucibello2001}.
Methods like these extend to a broader class of model perturbation (e.g., scaling forward speed and turning rate by different amounts) and to other types of uncertainty.
There is also an enormous literature on odometry calibration for wheeled mobile robots to reduce model perturbation \cite{Thrun2005,Siegwart2011}, from offline approaches like ``UMBmark'' \cite{Borenstein1995} to approaches that are online \cite{Antonelli2007} and even simultaneous with localization \cite{Martinelli2007}.
These citations represent only a fraction of prior work on calibration and robust feedback control, all of which is more effective than what we propose when sensors are available.

Instead, we use the differential-drive robot as a hardware platform because the application of ensemble control theory to this system is easy to understand and leads to results that readers may find surprising. For example, our approximate steering algorithm---derived for an infinite-dimensional family of control systems and not just for a single unicycle---ultimately requires solving only one set of linear equations, which can be precomputed in closed form. Similarly, the formulation of these linear equations relies on series expansions that make explicit the trade-off between the cost and complexity of the resulting input trajectory and the extent to which this input trajectory is robust to model perturbation. Finally, the fact that inputs executed in open-loop will bring a real mobile robot to a neighborhood of the same Cartesian position regardless of wheel radius is something that we did not initially think possible \href{http://www.youtube.com/watch?v=8yYD_KMwfaM}{(see the online video http://www.youtube.com/watch?v=8yYD\_KMwfaM)}.

A similar case can be made for plate-ball manipulators. When sensor measurements of the ball's position and orientation are available, it is possible to use feedback control to overcome the parametric uncertainty we consider.   Several practical stabilizing controllers were presented in \cite{Date 2004,Das2004,Morin2008, Casagrande2009}.
 Oriolo and Vendittelli presented an iterative feedback controller for stabilizing the plate-ball system with guaranteed convergence even when the ball radius is set to an incorrect value \cite{Oriolo2003,Oriolo2005}.  Our method neither uses nor takes advantage of sensor feedback, yet open-loop inputs bring a real sphere to a desired position and orientation regardless of the sphere radius \href{http://www.youtube.com/watch?v=nPGz0Nd3QzE}{(see the online video http://www.youtube.com/watch?v=nPGz0Nd3QzE)}.


\subsection{Robust Control}

Robust control provides a framework for the design of feedback policies that compensate for model perturbation.
Consider the dynamic system
\begin{align*}
\dot{x} &= f(x,u,\epsilon) \\
y &= h(x,u,\epsilon),
\end{align*}
where $x$ is the state, $u$ is the input, $y$ is the measurement, and $\epsilon$ is an unknown but bounded parameter. We are free to define an equivalent system
\begin{align*}
\dot{x} &= Ax + Bu + w_{1} \\
y &= Cx+Du+w_{2},
\end{align*}
for example by linearization, that pushes all model perturbation and nonlinearity into the mapping
\[
\left( x,u,\epsilon \right) \mapsto \left( w_{1},w_{2} \right).
\]
The idea is then to replace this one unknown mapping by a set of known linear mappings that capture all possible input/output behavior. This approach has been a topic of study for over fifty years---a modern reference is the book~\cite{Dullerud2000}. Although our own work has much the same flavor, robust control theory is primarily focused on the problem of closed-loop stabilization with feedback, whereas we focus on the problem of open-loop steering in the absence of sensor measurements.
%As we said in Section~\ref{sec:introduction}
We emphasize again that robust feedback control is, in general, much more effective than what we propose when sensors are available, as they typically are for mobile robots. % (see Section \ref{sec:introduction}).
%as acknowledged in Section \ref{sec:introduction}.
%Nonetheless, we
We also note previous work on robust feedforward control~\cite{Singer1990}, on robust control using series expansions similar to what we will describe in Section~\ref{sec:algorithm} and \ref{subsec:RotatingApproxAboutXaxis}~\cite{Fischer1993}, and on the relationship between ensemble control and robust control~\cite{Li2009a}, this last work developed independently from a different perspective.




\subsection{Motion Planning under Uncertainty}

There is a vast literature on motion planning under uncertainty in robotics, excellent reviews of which may be found in texts such as~\cite{Mason2001,Thrun2005,LaValle2006}
and examples of which range from early work on preimage backchaining~\cite{Erdmann:1986} to very recent work on needle-steering using the stochastic motion roadmap~\cite{Alterovitz2008}.
As one example, we have drawn particular inspiration from work on sensorless manipulation~\cite{Erdmann1988}.
In this work, like our own, the basic idea is to explicitly maintain the set of all possible
robot configurations and to select a sequence of actions that reduces the size of this set and drives it toward some goal configuration.
Carefully selected primitive operations can make this easier.
For example, sensorless manipulation strategies often use a sequential composition of
primitive operations, ``squeezing'' a part either virtually with a programmable force field or simply between two flat, parallel plates~\cite{Goldberg1993,Canny1994}.
%These primitive operations make it easier to compute the set of reachable configurations.
Sensorless manipulation strategies also may take advantage of limit cycle behavior,
for example engineering fixed points and basins of attraction so that parts only exit a feeder when they reach the correct orientation~\cite{Lynch2002,Murphey2005}.
These two strategies have been applied to a much wider array of mechanisms such as vibratory bowls and tables~\cite{Goemans2006,Vose2008a} or assembly lines~\cite{Goldberg1993,Akella2000,Stappen2002},
and have also been extended to situations with stochastic uncertainty~\cite{Goldberg1999,Moll2002} and closed-loop feedback~\cite{Akella1999,Murphey2004a}.
Our interest in this particular collection of work also stems from our belief that ensemble control theory may provide new insight into sensorless manipulation of
%large numbers of
many
objects at once.


\section{Applications of Ensemble Control to Robotics}
%current 1.1, parts from Ch 2, ch2.1, 3, etc.
In this dissertation, we apply the framework of ensemble control theory to derive an approximate steering algorithm for two classical robotic systems---the nonholonomic unicycle and the plate-ball manipulator---in the presence of model perturbation that scales all inputs by an unknown but bounded constant. Chapter  \ref{chap-infUnicycle}  focuses on the nonholonomic unicycle and Chapter \ref{chap:ApproxPlate-BallSteering} focuses on the plate-ball manipulator.

%%TODO: conclusion?
%We hope that these results stimulate interest and provoke a new line of inquiry that may lead to practical application in robotics.
%Our own interest in ensemble control, for example, is largely motivated by potential application to grasping and sensorless manipulation. Consider the plate-ball problem introduced by Brockett and Dai \cite{Brockett1993}, a
%case study
%of rolling bodies in contact~\cite{Li1990,Jurdjevic1993,Marigo2000}. If the ball has unknown but bounded radius we show in Chapter  \ref{chap:ApproxPlate-BallSteering} that the resulting system is ensemble controllable. This result hints
%%that ensemble control may be
%at a new approach to robust manipulation of so-called ``toleranced parts'' \cite{Requicha1983,Akella2000a}, an ongoing problem in automated assembly and industrial parts handling.
%A considerable amount of work remains to be done, however, before ideas like this one find their way into practice.

In Chapter \ref{chap:FeedbackControlDiffDrive} we show how the same framework can be applied to feedback control of multi-robot systems under the constraint that every robot receives exactly the same control input. We focus on the nonholonomic unicycle, instantiated in experiment by a collection of differential-drive robots shown in Fig.~\ref{fig:ManyDiffDrive}. Assuming that each robot has a unique wheel size, we derive a globally asymptotically stabilizing feedback control policy. We show that this policy is robust to standard models of noise and scales to an arbitrary number of robots. These results suggest that our approach may have possible future application to control of micro- and nano-scale robotic systems, which are often subject to similar constraints.
   
We conclude in Chapter \ref{chap:FutureWork} with a discussion about directions for future research.


%   The contributions of this dissertation are threefold:
%   \begin{itemize}
%   \item Design a framework 
%	\begin{itemize}
%		\item Model robotic systems under bounded model perturbation
%		\item Method to ensemble control these systems 
%	\end{itemize}
%\item Apply framework to three robotic systems
%	\begin{itemize}
%		\item Steering a differential-drive robot with unknown wheel size
%		\item Steering the orientation of a sphere with unknown radius
%		\item Single-input feedback control of multi-robot system
%	\end{itemize}
%\item Experimental validation with prototype hardware
%	\begin{itemize}
%		\item Single-plate, multi-ball manipulator
%		\item Single input multi-robot system
%	\end{itemize}
%\end{itemize}
%   

 

 
 
%Consider the control-affine system with equations of motion given by
%\begin{align}\label{eq:AffineControlSys}
%\dot{q}(t) =  \sum_{i=1}^m g_i(q(t)) u_i(t)
%\end{align}
%%note that a drift term may be represented by increasing $m$ by one and setting u_m(t) = 0
%Given $\qstart,\qgoal\in\Cspace$ and $\mu>0$, the approximate steering
%problem
%%for a single unicycle
%is to find open-loop inputs
%\[
%u(t) \colon [0,T] \to \Uspace
%\]
%that result in $q(0)=\qstart$ and $\norm{q(T)-\qgoal}\leq\mu$ for free final time $T$, where $\norm{\cdot}$ is a suitable norm on $\Cspace$.
%If such inputs always exist then we say that \eqref{eq:AffineControlSys} is {\em approximately controllable}
%
%\subsection{Ensemble Control}
%We will solve this same approximate steering problem, but under some unknown, bounded, constant model perturbation. The resulting kinematics have the form
%
%\begin{align}\label{eq:genericEnsControlSys}
%\dot{q}(t,\epsilon) = \sum_{i=1}^m g_i(q(t,\epsilon)) u_i(t)
%\end{align}
% with perturbation $\epsilon$ in the finite range $D$.
%If we can find
%open-loop inputs $u_{i}(t)$  that result in $q(0,\epsilon)=\qstart$ and
%$\norm{q(T,\epsilon)-\qgoal}\leq\mu$
%for all $\epsilon \in D$, then we can certainly guarantee that the actual system, which corresponds to one particular value $\epsilon^{\ast}$ of $\epsilon$, will satisfy $\norm{q(T,\epsilon^{\ast})-\qgoal}\leq\mu$.
%If such inputs always exist then we say that \eqref{eq:genericEnsControlSys} is {\em ensemble controllable},
%%which should be
%interpreted as being approximately controllable on the function space $L_{\infty}\left(D,\Cspace\right)$.
%The concept of ensemble controllability is illustrated in Fig \ref{fig:ensembleControllability}.  
%
%\begin{figure}[ht]
%      \centering
%      \begin{overpic}[width=.5\columnwidth]{ensembleControllability}
%\scriptsize
%				\put(35,38){$u(t)$}
%				\put(42,62){$\epsilon$}
%				\put(102,62){$\epsilon$}
%				\put(0,100){$\Cspace$ }
%				\put(60,100){$\Cspace$ }
%				\put(15,83){ $q(0,\epsilon)$}
%				\put(27,29){ $q_0(\epsilon)$}
%				\put(75,92){ $q(T,\epsilon)$}
%				\put(48,35){ $q_T(\epsilon)$}
%				\put(100,80){$\mu>0$}
%				\put(38,22){$\qgoal(\epsilon)$}
%				\put(71,5){$L_{\infty}\left(D,\Cspace\right)$}
%	\end{overpic}
%      \caption{\label{fig:ensembleControllability} An illustration of \emph{ensemble controllabilty}.  $q_0(\epsilon)$ and $q_T(\epsilon)$ are two points on the function space $L_{\infty}\left(D,\Cspace\right)$ that correspond with two functions on the $\epsilon, \Cspace$ domain.  A system is \emph{ensemble controllable} if for any $\mu>0$, starting configuration $q(0,\epsilon)$ and desired final configuration $\qgoal(\epsilon)$, there exists a common control $u(t) \in \Uspace$ and final time $T$ such that the state of the ensemble at time $T$ is within $\mu$ of $q_d(\epsilon)$.  }
%   \end{figure}
   
%   
%   \subsection{Polynomial Approximation through Taylor Series Expansion}
%   In this thesis, after modeling the system \label{eq:genericEnsControlSys} as an ensemble control system, we develop piece-wise constant primitives for the input that can be scaled and concatenated to match Taylor series expansions in $\epsilon$ of the goal configuration $\qgoal(\epsilon)$.  This process is illustrated in Fig.~\ref{fig:ensembleControllabilitySeriesApprox}.
%   
%   \begin{figure}[ht]
%      \centering
%      \begin{overpic}[width=.5\columnwidth]{ensembleControllabilitySeriesApprox}
%\scriptsize
%				\put(99,15){$\mu>0$}
%				\put(105,0){$\epsilon$}
%				\put(45,-5){$1$}
%				\put(2,-5){$1-\delta$}
%				\put(80,-5){$1+\delta$}
%				\put(-1,75){$\Cspace$ }
%	
%				\put(28,4){$T_1$}
%				\put(22,50){$T_3$ }
%				\put(15,10){$T_5$}
%				\put(7,65){$T_7$ }
%				\put(7,32){ $T_9$}
%	\end{overpic}\\
%	\vspace{0.2in}
%      \caption{\label{fig:ensembleControllabilitySeriesApprox} An illustration of \emph{polynomial approximation} using the Taylor series.  Given the goal function $\qgoal(\epsilon)$  and bound $\mu>0$,  we can select the order $n$ such that the Taylor series approximation $T_n$ satisfies the error bound $\mu$.   }
%   \end{figure}
   

   
   
% \begin{figure}
%       \centering
%       \begin{overpic}[width=.5\columnwidth]{ensembleControllabilityOLD}
% \scriptsize
% 				\put(42,62){$\epsilon$}
% 				\put(102,62){$\epsilon$}
% 				\put(0,100){$Q$ }
% 				\put(60,100){$Q$ }
% 				\put(15,80){ $Q(0,\epsilon)$}
% 				\put(27,29){ $Q_0(\epsilon)$}
% 				\put(80,86){ $Q(T,\epsilon)$}
% 				\put(48,35){ $Q_T(\epsilon)$}
% 				\put(39,19){$\mu>0$}
% 				\put(61,25){$Q_d(\epsilon)$}
% 				\put(71,5){$L_{\infty}(D,M)$}
% 	\end{overpic}
%       \caption{\label{fig:ensembleControllability} An illustration of \emph{ensemble controllabilty}.  $Q_0(\epsilon)$ and $Q_T(\epsilon)$ are two points on the function space $L_{\infty}(D,M)$ that correspond with two functions on the $\epsilon, Q$ domain.  A system is \emph{ensemble controllable} if for any $\mu>0$, starting position $Q(0,\epsilon)$ and desired final position $Q_d(\epsilon)$, there exists a common control $u(t)$ and final time $T$ such that the state of the ensemble at time $T$ is within $\mu$ of $Q_d(\epsilon)$.  }
%    \end{figure}



%\todo{
%Answer: what is ensemble controllability?
%show Li's result on systems that are not ensemble controllable.
%}



%%  NEVER SAY :Smorgasbord ;-)
%\section{Smorgasbord of Ensemble Controllable Systems}\label{sec:smorgasbordEnsSys}

%In this dissertation we focus on two systems as prototypes for ensemble control techniques.  We study first the kinematic unicycle with perturbation that scales linear and angular velocities and second orienting spheres by rolling despite perturbation that scales the sphere radius.  In this section we suggest several other common systems amenable for ensemble control.

%\subsection{Kinematic Unicycle}



   
  % \subsection{Sphere Orientation through Rolling}
   


%   \subsection{Simple Harmonic Motion}
%\begin{figure}[h]
%      \centering
%      \begin{overpic}[width=.15\columnwidth]{SimplePendEnsCont}
%\scriptsize
%				%\put(20,10){$m$ }  %independent of mass of bob
%				\put(2,57){$\sqrt{\epsilon} \ell$ }
%				\put(40,38){$\theta$}
%				\put(18,47){$\epsilon \omega(t)$ }
%	\end{overpic}\hspace{1in}
%      \begin{overpic}[width=.45\columnwidth]{massSpringEnsCont}
%\scriptsize
%				\put(60,9){$x, \dot{x}$ }
%				\put(77,27){$m$ }
%				\put(30,45){$\epsilon k$ }
%	\end{overpic}
%      \caption{\label{fig:SimplePendAndMassSpringEnsCont} Simple harmonic motion with perturbation in natural frequency is ensemble controllable.}
%   \end{figure}
% \begin{figure}
%       \centering
%       \begin{overpic}[width=.45\columnwidth]{UnicycleWheelDiffWheelEnsCont}
% \scriptsize
% 				\put(52,4){$x$ }
% 				\put(-5,50){$y$ }
% 				\put(70,62){$\theta, \frac{\epsilon \omega(t)$ }
% 				\put(57,80){$frac{\epsilon_\ell +\epsilon_r}{2}  v(t)$ }
% 				\put(32,22){$b$ }
% 				\put(10,70){$r\epsilon_{\ell}$ }
% 				\put(71,20){$r\epsilon_r$ }
% 	\end{overpic}
%       \caption{\label{fig:UnicycleWheelDiffWheelEnsCont} A differential-drive robot with unicycle kinematics with parameter perturbation in either the wheel radius or the wheelbase length is ensemble controllable.  The state is $x,y,\theta$ with inputs $v(t)$ and $\omega(t)$}
%    \end{figure}
   
%   \subsection{Planar Body With Thrusters}   
%\begin{figure}[h]
%      \centering
%      \begin{overpic}[width=.5\columnwidth]{PBWT}
%				\put(36,90){$u_2$ }
%				\put(57,72){$q_3$ }
%				\put(45,68){$u_1$ }
%				\put(74,64){$\left(q_1,q_2\right)$ }
%				\put(5,50){$q_2$ }
%				\put(49,59){$d$ }
%				\put(71,48){$a_g$ }
%				\put(50,5){$q_1$ }
%	\end{overpic}
%      \caption{\label{fig:PBWT}
%The planar body with thrusters $\left(u_1,u_2\right)$ is fully controllable as long as $d$ the distance from the line of thrust of $u_2$ and the COM is non zero.  When this distance is perturbed $\epsilon d$, the ensemble is still controllable.}
%   \end{figure}

%
%   \subsection{Artificial Bacteria Flagellas}
%\begin{figure}[h]
%\centering
%\begin{overpic}[width=.5\columnwidth]{ABFkine}
%%\put(9,22){Bode Diagram, Vertical Magnetic Field}
%\put(-5,40){$y$}
%\put(67,7){$x$}
%\put(77,37){$\psi$}
%\put(70,25){$\psi_M$}
%\end{overpic}
%\caption{\label{fig:ABFkine}
%Kinematic model of an Artificial Bacteria Flagella $\mu$robot.  The magnetic field $M$ exerts a force to align the ABF axis $\psi$ with the field $\psi_M$.   If the rate of response $\dot{\psi}$ is perturbed, the ensemble is still controllable.
%}
%\end{figure}



%\section{Non-Ensemble Controllable Systems}
%
%
%Li, in \cite{Li2011a} 
%Produced the following result on linear ensemble control systems
%For the family $\left(A(s),b(s)\right)$ of time-invariant linear single-input controllable systems
%\begin{align*}
%\dot{X}(t,\epsilon) = A(\epsilon)X(t,\epsilon) + b(\epsilon)u(t)
%\end{align}
%where $\epsilon$ takes values from a finite set $D \subset \R, A(\epsilon) \in \R^{n\timesn$, $b(\epsilon)\in \R^n$, and $u:[0,T] \rightarrow \R, \quad T < \infty$.  If this system is controllable, there are no repeated eigenvalues of $A(\epsilon)$ for all $\epsilon$ 
%
%\section{Controllability With Constrained Controls }
%
%         We have shown that ensembles of Bloch equations and the kinematic unicycle are controllable with unconstrained inputs.  Sometimes it is impossible to generate both positive and negative control inputs due to physical constraints on the system.  Airplanes can be modeled as Dubin's cars \cite{Dubins1957}, because they can turn, but must always have a positive velocity.  The scratch-drive robot designed by Donald et al.~\cite{Donald2006,Donald2008} are constrained to have non-negative angular and linear velocities.
%         
%       The study of \emph{constrained  control} examines systems with constraints on the control input  \cite{Peichl1986,Chukwu1991,Jerzy1996,Klamka2000,Jerzy2005}.
%       
%       In a series of articles,  \cite{Jerzy1996,Klamka2000} Klamka examines infinite dimensional systems with control values in a convex and closed cone with vertex at zero, e.g. $(u(t) \ge 0,v(t) \ge 0)$.  Let $U_0 \subset U$ be such a constrained control. In \cite{Klamka2000},  Klamka focuses on approximate controllability.
%       
%       \[U_{ad} = L_{\inf}\left([0,T],U_0\right)\]
%       
%       
%       %Note \cite{Jerzy1996} studies nonlinear constrained exact control,  \cite{Klamka2000} studies  linear constrained approximate control,
%       
%       % We want nonlinear constraind approximate control
%       
%       
%       %Show that with only positive controls, the Bloch equations are controllable.  Also show with 1 input.
%       
%       The Bloch equations describe the evolution of  a magnetization unit vector in $\R^3$.  Consider the Bloch equations with a single control $u(t)$ and nonuniform drift $\omega$, $\omega \in [1-\delta, 1+\delta]$.  In this section, we will show that with nonnegative, unbounded inputs the system is controllable.  The equation of motion is
%       \begin{equation}
%       \frac{d}{dt}\begin{bmatrix}
%x \\
%y \\
%z\\
%\end{bmatrix} = \begin{bmatrix}
%0 &-\omega & u(t) \\
%\omega &0 &0\\
%-u(t) &o & 0 \\
%\end{bmatrix}
%\begin{bmatrix}
%x \\
%y \\
%z\\
%\end{bmatrix} 
%\label{eq:bloch1control}
%   \end{equation}
%Rewrite with $X = [x,y,z]^T$ and
%
%     \begin{align}
%\Omega_x &= \begin{bmatrix}
%0 &0 & 0 \\
%0 &0 &-1 \\
%0 &1 & 0 \\
%\end{bmatrix},  
%\Omega_y = \begin{bmatrix}
%0 &0 & 1 \\
%0 &0 & 0 \\
%-1&0 & 0 \\
%\end{bmatrix},
%\Omega_z = \begin{bmatrix}
%0 &-1 & 0 \\
%1 &0 & 0 \\
%0 &0 & 0 \\
%\end{bmatrix},  \nonumber
%\end{align}
%The generators of rotation in three axis.
%
%       Then we can rewrite \eqref{eq:bloch1control} as
%       \[\dot{X} = \left[\omega \Omega_z + u(t) \Omega_y\right] X. \]
%       
%       For small time $dt$, the evolution 
%       \[U_1(dt) = \exp( -\omega_w\Omega_z) \exp( -\Omega_y) \exp( \omega_w\Omega_z) \exp( -\Omega_y) \]
%       produces motion (to the leading order) in the bracket direction $\omega \Omega_x = [\omega \Omega_z, \Omega_y ] = \textrm{ad}_{\omega \Omega_z}\Omega_y$.  Continuing to higher brackets,
%       \begin{align*}
%        \textrm{ad}^1_{\omega \Omega_z}\Omega_y &=
%       [\omega \Omega_z, \Omega_y]&&= -\omega \Omega_x \\
%       \textrm{ad}^2_{\omega \Omega_z}\Omega_y &=
%       [\omega \Omega_z, [\omega \Omega_z, \Omega_y]] &&= -\omega^2 \Omega_y \\
%      \textrm{ad}^3_{\omega \Omega_z}\Omega_y &=
%       [\omega \Omega_z, [\omega \Omega_z, [\omega \Omega_z, \Omega_y]] &&= \omega^3 \Omega_x \\
%       \textrm{ad}^4_{\omega \Omega_z}\Omega_y &=
%      \ldots &&= \omega^4 \Omega_y \\
%       \textrm{ad}^5_{\omega \Omega_z}\Omega_y &=
%      \ldots &&= -\omega^5 \Omega_x \\
%      & \vdots &\\
%      \textrm{ad}^{2n-1}_{\omega \Omega_z}\Omega_y &=
%      \ldots &&=  (-1)^{n}\omega^{2n-1} \Omega_x \\
%      \textrm{ad}^{2n-1}_{\omega \Omega_z}\Omega_y &=
%      \ldots &&=  (-1)^{n+1}\omega^{2n} \Omega_y .
%      \end{align*}
%     % $\textrm{ad}^{2n}_{\omega \Omega_z}\Omega_y =   $
%      Similarly, we can construct bracket directions in $\Omega_z$ by
%       \begin{align*}
%        \textrm{ad}^1_{\Omega_y}\textrm{ad}^1_{\omega \Omega_z}\Omega_y &=
%       [\Omega_y,[\omega \Omega_z, \Omega_y]]&&= \omega \Omega_z \\
%       \textrm{ad}^1_{\Omega_y}\textrm{ad}^3_{\omega \Omega_z}\Omega_y &=
%       [\Omega_y[\omega \Omega_z, [\omega \Omega_z, [\omega \Omega_z, \Omega_y]]] &&= -\omega^3 \Omega_z \\
%        \textrm{ad}^1_{\Omega_y}\textrm{ad}^5_{\omega \Omega_z}\Omega_y &=
%      \ldots &&= \omega^5 \Omega_z \\
%      & \vdots &&\\
%      \textrm{ad}^1_{\Omega_y}\textrm{ad}^{2n-1}_{\omega \Omega_z}\Omega_y &=
%      \ldots &&= (-1)^{n+1}\omega^{2n-1} \Omega_z .
%      \end{align*}
%    
%    
%    
%    Li, in \cite{Li2006}, showed that unbounded control can reverse the evolution of the drift term
%    \[ \exp(\pi \Omega_y) \exp(\omega \Omega_z) \exp(-\pi \Omega_y) = \exp(-\omega \Omega_z). \]
%Note that even if $u(t)$ is constrained to be nonnegative, the same reversal of the drift term is possible, since
%      \[ \exp(\pi \Omega_y) \exp(\omega \Omega_z) \exp(\pi \Omega_y) = \exp(-\omega \Omega_z). \]
%    These techniques with nonnegative control do not apply  for a system without drift ($\omega = 0$), but with rf inhomogeneity ($\epsilon$) in the system 
%      \[\dot{X} = \epsilon\left[ v(t) \Omega_x + u(t) \Omega_y\right] X \]
%      because 
%       \[ \exp(\epsilon \pi \Omega_x) \exp(\epsilon \Omega_y) \exp(\pi \epsilon \Omega_x) \ne \exp(-\epsilon \Omega_y). \]
%       
%       Beauchard, in \cite{Beauchard2010}, shows that the linearized system about starting position $e_3$ is approximately controllable.   This technique does not work for systems without drift because the linearized system without drift no longer ensemble uncontrollable.
%       
       
       
       